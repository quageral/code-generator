# 技术选型

前端

- React 开发框架 + 组件库 + 代码编辑器
- 前端工程化：ESLint + Prettier + TypeScript

后端

- Java Spring Boot + MySQL + MyBatis Plus（万用后端模板）
- Java 命令行应用开发
- **FreeMarker 模板引擎**
- **Vert.x 响应式编程**(并发能力超过spring)
- **Caffeine + Redis 多级缓存**
- 分布式任务调度系统
- 多种设计模式
- 多种系统设计的巧思
- 对象存储


# 项目三步走

## 第一阶段：代码生成器（给使用者的生成器）

业务流程
1）准备用于制作代码生成器的原始代码（比如 Java ACM 模板项目），用于后续生成
2）开发者基于原始代码，设置参数、编写动态模板
3）制作可交互的命令行工具，支持用户输入参数，得到代码生成器 jar 包
4）使用者得到代码生成器 jar 包，执行程序并输入参数，从而生成完整代码（eg. 若依）



![image-20240119105355892](https://s2.loli.net/2024/01/19/jqtRbzxoaMVKiED.png)



## 第二阶段：(给开发者的生成器)

![image-20240119105422066](https://s2.loli.net/2024/01/19/KfoeFNJ5W1jULDM.png)



## 第三阶段：线上平台（在线分享）

![image-20240119105438493](https://s2.loli.net/2024/01/19/Q3RmK6fDlS4dj8v.png)



# 第一阶段

使用Hutool：静态文件生成、进行文件复制等操作。

使用FreeMarker模板引擎：用"模板+数据模型"进行动态文件的生成。

使用Picocli：利用注解，开发基于命令行的代码生成器。支持可交互式输入。

使用命令模式：对generate、config、list三个参数的进行封装。**优点：**解耦请求发送者和接受者，让系统更加灵活、可扩展。由于每个操作都是一个独立的命令类，所以我们需要新增命令操作时，不需要改动现有代码。

使用定制化打包方式`maven-assembly-plugin`和脚本文件：可以在命令行运行jar包的Main类，生成所有代码文件。

<mark>阶段总结</mark>：得到一个基于命令行的代码生成器。

# 第二阶段

## 实现流程

### 1.制作一个”可以生成acm-template项目的生成器”的生成器（给开发者的）

- 将所有在第一阶段的代码文件，都转换成模板文件和元信息的模式。
- 将Maven打包，脚本封装都用代码完成



### 2.功能优化

可移植性：元信息增加一个源文件路径，用来复制模板代码到代码生成器。

健壮性：增加校验类，自定义异常类。对输入的元信息进行校验。（`MetaValidator`类，主要是做了判空和赋默认值）

可扩展性：定义枚举类代替硬编码字符串（魔法值），使用模板方法定义生成器流程（父类定义一套流程，子类有不同的实现细节）



### 3.制作一个springboot-init项目的代码生成器（一个博客模板项目）

需要实现的需求：

1. 替换生成的代码包名（已经实现）
2. 控制是否生成帖子相关功能
3. 控制是否需要开启跨域
4. 自定义 Knife4jConfig 接口文档配置
5. 自定义 MySQL 配置信息
6. 控制是否开启 Redis
7. 控制是否开启 Elasticsearch

这些需求所对应的功能：

1. 一个模型参数对应某个文件是否生成
2. 一个模型参数对应多个文件是否生成
3. 一个模型参数同时控制多处代码修改以及文件是否生成（通过文件分组功能实现）
4. 定义一组相关的模型参数，控制代码修改或文件生成
5. 定义一组相关的模型参数，并能够通过其他的模型参数控制是否需要输入该组参数（通过模型分组功能实现）



### 4.功能优化

1）分布制作：根据雪花算法生成唯一ID，多次生成时追踪这个ID

2）文件筛选：设置过滤规则，在模型参数中使用，可以帮助用户筛选文件。

- 过滤范围：根据文件名称（fileName）、或者文件内容（fileContent）过滤。
- 过滤规则：包含 contains、前缀匹配 startsWith、后缀匹配 endsWith、正则 regex、相等 equals。

3）文件/模型分组



## 阶段总结

第二阶段除了大量的功能优化以外，还修复了10个左右的bug（幺蛾子）。比如FreeMarker和Mybatis的变量命名冲突、动态文件被重新生成为静态等。详细内容记录在`定制化-流程与问题.md`。这一阶段，项目实现：根据一或多个json文件生成“ftl项目模板”，并用代码生成相应的“生成器”（Generator，将第一阶段做的内容定制化得到）。两者结合得到最终的定制化springboot-init项目。
